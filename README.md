Warning: There is a lot of shitty code here, so I would advise you to stay out of here.